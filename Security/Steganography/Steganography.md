Привет. Мне тут сказали, что занятие в субботу не состоится, поэтому меня 
попросили сделать статью на тему того, что я хотел рассказать.
Рассказать я хотел о задачах на стеганографию на duckerz.ru

Прикладываю 3 вещи:
1) Райтапы на все таски по стеганографии с duckerz, которые я решил
2) Идеи и наблюдения связанные с тасками, которые я не решил
3) Общую статью по стеганографии (просто аккумулирую всё, что сам знаю). Данный файл и есть статья

Поехали.
### Что такое стеганография?
Это вставка каких-либо секретных данных внутрь других данных.
В CTF'ных тасках (лёгкой и средней сложности в категориях duckerz) 
используются в основном несколько стандартных способов стеганографии, тут
кратко опишу некоторые из них и способы работы с ними.

#### Методы стеганографии
Есть ряд способов вшития данных. Некоторые из них универсальны, некоторые нет. 

#### Универсальные методы стеганографии
Универсальные методы стеганографии - это такие методы, которые применимы вне зависимости от того, с какими данными мы работаем.

1) Запись в метаданные. Почти у всех форматов файлов есть метаданные, иногда что-то интересное может хранится в самом начале файла (как правило, метаданные размещаются в начале)
2) Вставка данных plaintext'ом в файл

Все три способа замечательно решаются при помощи strings:
```bash
strings -n 10 filename.ext
strings -t -n 10 filename.ext
```

#### Форматы файлов для изображений
Рассмотрим несколько форматов файлов: bmp, png, jpg.
Есть и другие, но мне разбираться с ними не приходилось.
Я разместил их в порядке увеличения степени сжатия данных. Разберёмся 
поподробнее:

##### BMP
BMP - это самый сырой формат из всех. Всё, что он в себе содержит, это 
информацию о размере картинки, а также огромный "вал" из троек по три 
байта, которые кодируют один пиксель. Никакого сжатия не происходит

##### PNG
PNG - формат сжатия без потерь. Содержит в себе больше метаинформации.
В типичном случае в нём есть:
1) Метаданные
2) Чанки
Чанки представляют собой куски данных определённого размера, 
начинающиеся со слова IDAT и размера чанка, и оканчивающиеся на checksum. 
Соответственно, если взять и перетереть какой-нибудь байт в png, то любой 
просмотрщик может пожаловаться на проблемы с checksum. Но даже 
восстановив checksum не факт, что можно будет снова открыть файл (у меня 
часто выскакивала ошибка "bad adaptive filter value", или что-то подобное)
На самом деле в png могут  очень разные "сегменты" использоваться, но на 
практике даже таких знаний достаточно. Последний чанк помечается словом 
IEND, он уже ничего в себе не содержит.

##### JPG
JPG - формат сжатия с потерями. Про структуру ничего не скажу, ибо самому
не приходилось её гуглить. Может содержать exif данные в себе (что полезно
при osint)

#### Методы стеганографии в картинках
Для картинок типично используются следующие методы стеганографии:
1) LSB - least significant bit. Основано на том, что мы не заметим изменений в картинке, если в ней изменить 1 или 2 последних бита. Таким образом в одно изображение можно вшить другое. Данный способ применим только для форматов сжатия без потерь (или без сжатия). В jpg неприменим, так как эти "малозначимые" биты вполне могут перетереться.
2) Использование альфа-канала. На одном из CTF была односительно сложная задача на стеганографию. В ней использовалось 4 канала, в альфа-канале помечались пиксели изображения, правильно обработав информацию в которых можно было собрать флаг
3) rar.jpeg. Иногда в самый конец картинки вшиваются архивы; тут важно опознать сигнатуру архива (для .zip это PK, например)
4) steghide. Позволяет вшить в картинку данные, и при этом ещё и защищать их паролем. Можно опознать по наличию характерных строк, состоящих из цифр и английских букв, идущих подряд (пример строки: 456789:CDEFGHIJSTUVWXYZ)
5) Битые изображения. Иногда есть такие таски, в которых перетирается сигнатура либо какие-либо другие данные, и тогда восстанавливать целостность файла придётся в ручном режиме

Для пунктов 1 и 2 можно использоваться stegsolve (локально) либо сайт StegOnline:
https://www.georgeom.net/StegOnline/upload

Если видим таску вида rar.jpeg то можно поступить так:
1) Открыть файл в виме (довольно кривой способ, но на самом деле рабочий; данные архивов ведь размещены в конце, поэтому просто отмотав в конец файла можно обнаружить интересные данные)
2) `binwalk -Me filename`  может помочь извлечь скрытые файлы в уже имеющемся файле (у меня почему-то не получалось)
3) Опять же, пройтись при помощи strings и обнаружить что-то подозрительное в выводе

#### Методы стеганографии в аудиофайлах
Здесь мне известен один метод: использование спектра
Чтобы решить такие таски можно закинуть файл в онлайн-анализатор:
https://www.dcode.fr/spectral-analysis

(вообще, классный сайт, там же можно и многие таски на крипту решать)
(есть и другие офк)

#### Текстовая стеганография
Тут относительно широкий простор для творчества у авторов заданий.
Перечислю то, что знаю:
1) stegsnow. Тулза позволяет вшить данные в текстовый файл при помощи пробелов и табуляций на концах строк. Извлекать данные из файлов при помощи этой команды можно так: `stegsnow -C filename`
2) Текст с ошибками. Ошибки могут означать, что определённая буква, в которой допущена ошибка, может быть частью флага (в райтапах - подробнее)
3) Шифр Бэкона. При помощи написания части букв каким-либо другим способом (курсивом, либо заглавными) можно взять и застеганить другой текст. Пример:

```
Составляем таблицу:
A: 00000
B: 00001
C: 00010
...
Z: 11001

Попытаемся застеганить строку SECRET:
S: 10010
E: 00100
C: 00010
R: 10001
E: 00100
T: 10011

ThiS is sOme samPlE texT, crEatEd wITh hands

Как раскодировать, думаю, инуитивно понятно)
Но последние 6 символов могут раскодироваться ещё и в букву A, но это не большая проблема.
```

4) Невидимые символы. В unicode есть ряд символов, которые могут не отображаться при помощи текстовых редакторов. Пример: пробел нулевой длины. Для решения какой-то автоматической тулзы нет, придётся думать

На этом всё. Если хочется узнать больше:
https://www.youtube.com/watch?v=7lNTMNITcSA